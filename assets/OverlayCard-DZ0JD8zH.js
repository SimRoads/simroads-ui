import{B as z,V as O,a as Z,b as M}from"./BaseCard-YwwZ8Pbe.js";import{H as P,I as R,Q as U,h as m,R as $,w as D,L as f,S as E,M as l,O as _,U as F,V as W,K as o,c as p,W as h,N as S,P as B,X as b,F as V,Y as I,Z as w,_ as j,$ as H,a0 as K}from"./index-iVPC1WgH.js";import{t as x}from"./data-DHvaU8Dv.js";import{j as Q,h as X}from"./VAvatar-dmscyC76.js";import{c as Y,a as q,e as J,f as ee,g as ae}from"./VList-t7JIXIjE.js";import"./VBtn-DlegZ2NC.js";const te=u=>(j("data-v-d6c6c515"),u=u(),H(),u),re=te(()=>w("span",null,null,-1)),se={class:"px-4"},oe=P({__name:"OverlayCard",props:{prefab:{},id:{}},setup(u){const i=u,L=R(),y=U(),A=m(()=>`overlays/${i.prefab}`),d=$(A),t=m(()=>Array.isArray(d.value)?d.value.find(e=>e.id==i.id):d.value),k=m(()=>{var e;switch((e=t.value)==null?void 0:e.type){case"city":return"overlays-cities";case"country":return"overlays-countries"}return i.prefab!=i.id?"overlays-prefabs":"overlays-non-prefabs"});D(t,e=>e&&N(e.envelope));const C=m(()=>Array.isArray(d.value)?d.value.filter(e=>e.id!=i.id):[]),g=m(()=>{var e;return URL.createObjectURL(new Blob([(e=t.value)==null?void 0:e.icon],{type:"image/png"}))}),G=e=>{let n=e.minzoom||0;if(e.paint){const r=e.paint;for(const s in r)s.endsWith("opacity")&&Array.isArray(r[s])&&r[s][0]=="interpolate"&&r[s][2][0]=="zoom"&&(n=Math.max(n,r[s][r[s].length-2]))}return n},N=e=>{var n,r,s,a;if(L.map){if(e=F(L.map,e),e.type==="Point"){const c=L.layers[k.value],v=G(c);(s=y.map)==null||s.flyTo({center:e.coordinates,zoom:(k.value.endsWith("prefabs")?Math.max(v,(n=y.map)==null?void 0:n.getZoom()):v)||((r=y.map)==null?void 0:r.getZoom())||0})}else if(e.type=="Polygon"){const c=e.coordinates[0].reduce((v,T)=>v.extend(T),new W.LngLatBounds([e.coordinates[0][0],e.coordinates[0][1]]));(a=y.map)==null||a.fitBounds(c,{padding:100})}}};return(e,n)=>{var r;return o(),f(z,{title:_(x)((r=t.value)==null?void 0:r.title)||t.value===!1&&e.$t("not_found")||null},E({default:l(()=>{var s;return[t.value?(o(),h(V,{key:0},[re,t.value.subtitle?(o(),f(O,{key:0},{default:l(()=>[S(B(_(x)(t.value.subtitle)),1)]),_:1})):b("",!0),t.value.city||t.value.country?(o(),f(Z,{key:1,class:"pa-1"},{default:l(()=>[p(q,{density:"compact"},{default:l(()=>[(o(!0),h(V,null,I([[t.value.city,"mdi-city"],[t.value.country,"mdi-earth"]].filter(([a,c])=>a),([a,c])=>(o(),f(Y,{key:a==null?void 0:a.id,"prepend-icon":c,title:_(x)(a.title),to:{name:"overlay",params:{id:a.id,prefab:a.id}}},null,8,["prepend-icon","title","to"]))),128))]),_:1})]),_:1})):b("",!0),((s=C.value)==null?void 0:s.length)>0?(o(),h(V,{key:2},[p(J,{class:"mx-4 mb-1"}),p(M,null,{default:l(()=>[S(B(e.$t("in_same_place")),1)]),_:1}),w("div",se,[p(ae,null,{default:l(()=>[(o(!0),h(V,null,I(C.value,a=>(o(),f(ee,{key:a.id,to:{name:"overlay",params:{id:a.id,prefab:i.prefab}},text:_(x)(a.title)},null,8,["to","text"]))),128))]),_:1})])],64)):b("",!0)],64)):b("",!0)]}),_:2},[g.value?{name:"prepend",fn:l(()=>[p(Q,{src:g.value,width:45},null,8,["src"])]),key:"0"}:t.value===!1?{name:"prepend",fn:l(()=>[p(X,{class:"ma-2",icon:"mdi-alert",size:"large"})]),key:"1"}:void 0]),1032,["title"])}}}),de=K(oe,[["__scopeId","data-v-d6c6c515"]]);export{de as default};
